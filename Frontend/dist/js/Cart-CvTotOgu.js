import{j as e,c as t}from"./ui-vendor-D_YnDhxq.js";import{u as a,R as r,a as s}from"./react-vendor-B1YRfcvv.js";import{u as i,e as o}from"./redux-vendor-Cc4mDNFq.js";import{c as n,d,e as c}from"./index-D8HxDPmi.js";import{am as l,ao as m,an as x}from"./index-BpOdPcLd.js";import"./utils-vendor-B4hhIH4d.js";const u=()=>{const u=i(),h=a(),p=o(e=>e.auth.user),y=o(e=>e.cart.items),j=o(e=>e.cart.totalAmount),[b,f]=r.useState(!1),[g,N]=r.useState(!1);s.useEffect(()=>{p&&(async()=>{try{const e=await fetch("/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),a=await e.json();a.success?u(l(a.cartItems)):t.error("Failed to load cart")}catch(e){t.error("Error loading cart")}})()},[u,p]);const v=async(e,a)=>{const r=y.find(t=>t._id===e);if(!r)return;const s="inc"===a?r.quantity+1:Math.max(1,r.quantity-1);try{const a=await fetch(`/api/cart/update/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({testOrPackageId:e,quantity:s,type:r.type||"Test",name:r.name,price:r.price,labId:r.labId})}),i=await a.json();i.success?u(m({_id:e,quantity:s})):t.error(i.message||"Failed to update quantity")}catch(i){t.error("Failed to update quantity")}};return y&&0!==y.length?e.jsxs("div",{className:"mt-10 p-6 bg-white rounded-xl shadow-md border",children:[e.jsx("h2",{className:"text-xl font-bold text-primary mb-4",children:"Your Cart"}),e.jsx("div",{className:"space-y-4",children:y.map(a=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["$ ",a.price," x ",a.quantity," = $ ",(a.price*a.quantity).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>v(a._id,"dec"),className:"p-1 rounded text-primary hover:bg-gray-100",disabled:g,children:e.jsx(n,{})}),e.jsx("span",{className:"w-6 text-center",children:a.quantity}),e.jsx("button",{onClick:()=>v(a._id,"inc"),className:"p-1 rounded text-primary hover:bg-gray-100",disabled:g,children:e.jsx(d,{})}),e.jsx("button",{onClick:()=>(async e=>{if(!g){N(!0);try{const a=await fetch(`/api/cart/remove/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});(await a.json()).success?(u(x(e)),t.success("Item removed")):t.error("Failed to remove item")}catch(a){t.error("Failed to remove item")}finally{N(!1)}}})(a._id),className:"p-1 rounded text-red-500 hover:bg-red-50",disabled:g,children:e.jsx(c,{})})]})]},a._id))}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-lg",children:"Total:"}),e.jsxs("span",{className:"text-primary font-bold text-xl",children:[" $ ",j.toFixed(2)]})]}),e.jsx("button",{onClick:()=>{f(!0),h("/place-order")},disabled:b||g,className:"mt-4 w-full py-2 rounded transition \n        "+(b||g?"bg-gray-400 cursor-not-allowed":"bg-primary text-white hover:bg-primary-dark"),children:b?"Loading...":"Proceed to Order"})]}):e.jsxs("div",{className:"bg-white shadow-md rounded-xl p-6 max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-primary mb-4",children:"Your Cart"}),e.jsx("p",{className:"text-gray-500",children:"No items in cart."})]})};export{u as default};
