import{j as e,V as r}from"./ui-vendor-D_YnDhxq.js";import{f as s,u as t,a}from"./react-vendor-B1YRfcvv.js";import{L as o}from"./index-BpOdPcLd.js";import{e as n}from"./redux-vendor-Cc4mDNFq.js";import"./utils-vendor-B4hhIH4d.js";function d(e){if(!e)return"N/A";const[r,s]=e.split(":"),t=new Date;return t.setHours(+r),t.setMinutes(+s),t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}const l=()=>{var l,i;const{orderId:c}=s(),u=t(),[h,m]=a.useState(null),[p,x]=a.useState([]),[g,j]=a.useState(""),[b,f]=a.useState(""),[v,y]=a.useState(null),[N,S]=a.useState(!1),{user:w}=n(e=>e.auth);a.useEffect(()=>{(null==w?void 0:w.labId)&&(async()=>{var e;try{const s=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),t=null==w?void 0:w.labId,a=await fetch(`/api/orders/${c}`,{headers:{Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const o=await a.json();if(o.order){const s=o.order.items.filter(e=>{var r;const s=(null==(r=e.labId)?void 0:r._id)||e.labId;return s&&s.toString()===t.toString()});if(0===s.length)return r.error("No items found for your lab in this order"),void u("/labadmin/lab/orders");const a=o.order.userId?`${o.order.userId.firstName||""} ${o.order.userId.lastName||""}`.trim()||"N/A":o.order.name||"N/A",n=(null==(e=s[0])?void 0:e.status)||"Pending";m({...o.order,patientName:a}),x(s),j(n),f(o.order.paymentStatus||"pending")}else r.error(o.message||"Failed to load order"),u("/labadmin/lab/orders")}catch(s){r.error(s.message||"Error loading order"),u("/labadmin/lab/orders")}})()},[c,u,w]);return h&&p.length?e.jsxs("div",{className:"p-6 bg-white shadow-md rounded max-w-4xl mx-auto mt-10 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>u("/labadmin/lab/orders"),className:"text-sm bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded",children:"â† Back to Orders"}),e.jsx("button",{onClick:()=>u("/labadmin/lab/orders"),className:"text-gray-600 hover:text-red-500 text-xl",title:"Close",children:e.jsx(o,{})})]}),e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-800",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Patient Name:"})," ",h.patientName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",h.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",h.phoneNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",h.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",h.age]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",h.address,", ",h.state,", ",h.country]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Collection Method:"})," ",h.collectionMethod]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Order Date:"})," ",(null==(l=h.bookingDetails)?void 0:l.date)&&(null==(i=h.bookingDetails)?void 0:i.time)?`${new Date(h.bookingDetails.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}, ${d(h.bookingDetails.time)}`:"N/A"]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Your Lab's Tests & Packages"}),e.jsx("ul",{className:"space-y-2",children:p.map((r,s)=>e.jsxs("li",{className:"border p-3 rounded",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",r.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",r.type]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price:"})," Rs. ",r.price]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Current Status:"})," ",r.status||"Pending"]})]},s))})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Update Status *"}),e.jsxs("select",{value:g,onChange:e=>j(e.target.value),className:"w-full border p-2 rounded",disabled:N,children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"In Progress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Payment Status *"}),e.jsxs("select",{value:b,onChange:e=>f(e.target.value),className:"w-full border p-2 rounded",disabled:N,children:[e.jsx("option",{value:"",children:"-- Select Payment Status --"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"unpaid",children:"Unpaid"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold",children:"Upload Report (Optional)"}),e.jsx("input",{type:"file",onChange:e=>y(e.target.files[0]),className:"w-full border p-2 rounded",accept:".pdf,.doc,.docx",disabled:N})]})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{onClick:async()=>{if(g&&b){S(!0);try{const e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),s=null==w?void 0:w.labId;let t=null;if(v){const r=new FormData;r.append("report",v);const s=await fetch(`/api/orders/${c}/upload-report`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:r});if(!s.ok)throw new Error("Failed to upload report");t=(await s.json()).reportFile}const a=await fetch(`/api/orders/${c}/lab/${s}/status`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({status:g,paymentStatus:b,reportFile:t})});if(!a.ok)throw new Error("Failed to update order status");const o=await a.json();if(!o.success)throw new Error(o.message||"Failed to update order");r.success("Order updated successfully"),m(o.order),x(o.order.items.filter(e=>{var r;return((null==(r=e.labId)?void 0:r._id)||e.labId).toString()===s.toString()})),u("/labadmin/lab/orders")}catch(e){r.error(e.message||"Error updating order")}finally{S(!1)}}else r.error("Both status and payment status are required.")},disabled:N||!g||!b,className:`px-6 py-2 rounded ${!N&&g&&b?"bg-primary hover:bg-primary/90":"bg-gray-400 cursor-not-allowed"} text-white font-semibold`,children:N?"Updating...":"Update Order"})})]}):e.jsx("p",{className:"p-6",children:"Loading order..."})};export{l as default};
