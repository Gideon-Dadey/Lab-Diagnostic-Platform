import{j as e}from"./ui-vendor-D_YnDhxq.js";import{a as t,u as s}from"./react-vendor-B1YRfcvv.js";import{V as a}from"./index-BpOdPcLd.js";import{l as r}from"./index-CYtxp7L5.js";import"./redux-vendor-Cc4mDNFq.js";import"./utils-vendor-B4hhIH4d.js";const i=r("pk_test_51S6UfLKteAtM6EfyngvpQoXMzIE8IUPeeglOhO0QXMXWqnmIYgjH5EqMuPlaw5MfmkX8ikSQzG4c6R12QYqQSywG00hbLkGRgt"),l=()=>{const[r,l]=t.useState(null),[n,o]=t.useState(!1),[c,d]=t.useState([]),[m,x]=t.useState(0),h=s();t.useEffect(()=>{const e=localStorage.getItem("bookingData");e?l(JSON.parse(e)):(alert("Booking details not found!"),h(-1));(async()=>{try{const e=await fetch("/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),t=await e.json();if(t.success){const e=t.cartItems.map(e=>({...e,quantity:e.quantity||1,totalPrice:e.price*(e.quantity||1)}));d(e);const s=e.reduce((e,t)=>e+t.totalPrice,0);x(s)}else d([])}catch(e){}})()},[h]);return e.jsxs("div",{className:"p-6 mt-32 max-w-5xl mx-auto bg-white shadow-lg rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-primary cursor-pointer",onClick:()=>h(-1),children:[e.jsx(a,{}),e.jsx("span",{className:"font-semibold",children:"Back"})]}),e.jsx("h2",{className:"text-2xl font-bold text-primary text-center mb-6",children:"Confirm Payment"}),r?e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-lg",children:[e.jsx("strong",{children:"Name:"})," ",r.name]}),e.jsxs("p",{className:"text-lg",children:[e.jsx("strong",{children:"Email:"})," ",r.email]}),e.jsxs("p",{className:"text-lg",children:[e.jsx("strong",{children:"Phone:"})," ",r.phoneNumber]}),e.jsxs("p",{className:"text-lg",children:[e.jsx("strong",{children:"Collection:"})," ",r.collectionMethod]})]}),e.jsx("h3",{className:"text-xl font-semibold mt-6 mb-2",children:"Order Summary"}),c.length>0?e.jsxs(e.Fragment,{children:[c.map(t=>e.jsxs("div",{className:"flex justify-between items-center mb-4 p-4 bg-gray-100 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Price: Rs ",t.price]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",t.quantity]})]}),e.jsxs("p",{className:"text-xl font-bold",children:["Rs ",t.totalPrice]})]},t._id)),e.jsxs("div",{className:"text-right font-bold text-lg mt-2",children:["Total: Rs ",m]})]}):e.jsx("p",{className:"text-red-500",children:"No items in cart."}),e.jsx("button",{onClick:async()=>{if(0!==c.length)try{o(!0);const e=await i,t=await fetch("/api/payment/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({items:c})}),s=await t.json();if(!s.id)return void alert("Failed to create Stripe session");(await e.redirectToCheckout({sessionId:s.id})).error&&alert("Stripe redirect failed.")}catch(e){alert("Payment failed. Try again later.")}finally{o(!1)}else alert("Cart is empty.")},disabled:n,className:"mt-6 w-full bg-primary text-white py-2 px-4 rounded hover:bg-primary-dark "+(n?"opacity-60 cursor-not-allowed":""),children:n?"Redirecting to Stripe...":"Proceed to Payment"})]}):e.jsx("p",{className:"text-center text-red-500",children:"No booking details found."})]})};export{l as default};
