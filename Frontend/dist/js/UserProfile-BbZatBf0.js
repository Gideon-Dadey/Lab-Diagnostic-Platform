import{j as e,c as a}from"./ui-vendor-D_YnDhxq.js";import{a as t}from"./react-vendor-B1YRfcvv.js";import{u as r,e as s}from"./redux-vendor-Cc4mDNFq.js";import{a as l}from"./utils-vendor-B4hhIH4d.js";import{ar as i,aD as n,L as d,ay as o,e as m}from"./index-BpOdPcLd.js";function c({label:a,children:t,hint:r}){return e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start gap-2 md:gap-6",children:[e.jsx("label",{className:"w-full md:w-44 text-sm text-gray-600",children:a}),e.jsx("div",{className:"flex-1",children:t}),r&&e.jsx("div",{className:"w-full md:w-40 text-xs text-gray-400",children:r})]})}function x(){return e.jsx("div",{className:"bg-white rounded-xl p-6 shadow animate-pulse max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200"}),e.jsxs("div",{className:"flex-1 space-y-3 py-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})})}function u(){var u,g;const h=r(),p=s(e=>{var a;return null==(a=e.auth)?void 0:a.user}),v=s(e=>{var a;return null==(a=e.auth)?void 0:a.token}),[N,f]=t.useState(null),[b,j]=t.useState("view"),[y,w]=t.useState(!0),[C,S]=t.useState(!1),[k,P]=t.useState(null),[U,E]=t.useState(""),F=t.useRef(null);t.useEffect(()=>{p&&(f({firstName:p.firstName||"",lastName:p.lastName||"",email:p.email||"",phoneNo:p.phoneNo||"",role:p.role||"User",image:p.image||""}),E(p.image||""),w(!1))},[p]);const $=t.useMemo(()=>N?`${N.firstName||""} ${N.lastName||""}`.trim():"",[N]),[T,A]=t.useState({});return y?e.jsx(x,{}):N?e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 flex items-center gap-3",children:["My Profile",e.jsxs("span",{className:"text-sm text-gray-500 font-medium",children:["â€” ",N.role]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:["view"===b?e.jsxs("button",{onClick:()=>j("edit"),className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100","aria-label":"Edit profile",children:[e.jsx(i,{})," Edit"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{var e,t,r,s,i;const n=(()=>{const e={};return(!N.firstName||N.firstName.trim().length<2)&&(e.firstName="Enter a valid first name"),(!N.lastName||N.lastName.trim().length<2)&&(e.lastName="Enter a valid last name"),N.phoneNo&&!/^\+?\d{7,15}$/.test(N.phoneNo)&&(e.phoneNo="Enter a valid phone number"),e})();if(A(n),Object.keys(n).length)a.error("Please fix validation errors");else{S(!0);try{let s=N.image;if(k){const e=await(async e=>{var t,r;if(!e)return null;const s=new FormData;s.append("avatar",e);try{const e=await l.post("/api/users/upload-avatar",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${localStorage.getItem("authToken")||v||""}`}});return(null==(t=e.data)?void 0:t.success)&&e.data.url?e.data.url:(null==(r=e.data)?void 0:r.url)||null}catch(i){return a.error("Avatar upload failed. Try again."),null}})(k);e&&(s=e)}const i={firstName:N.firstName.trim(),lastName:N.lastName.trim(),phoneNo:(null==(e=N.phoneNo)?void 0:e.trim())||"",image:s||""},n=await l.put("/api/users/me",i,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")||v||""}`}});if(null==(t=n.data)?void 0:t.success){const e=n.data.user||{...p,...i};h({type:"auth/updateUser",payload:e}),f(e=>({...e,...i})),P(null),a.success("Profile updated"),j("view")}else a.error((null==(r=n.data)?void 0:r.message)||"Failed to update profile")}catch(d){a.error((null==(i=null==(s=d.response)?void 0:s.data)?void 0:i.message)||"Failed to update profile")}finally{S(!1)}}},disabled:C,className:"inline-flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-60",children:[e.jsx(n,{})," ",C?"Saving...":"Save"]}),e.jsxs("button",{onClick:()=>{f({firstName:p.firstName||"",lastName:p.lastName||"",email:p.email||"",phoneNo:p.phoneNo||"",role:p.role||"User",image:p.image||""}),P(null),E(p.image||""),A({}),j("view")},className:"inline-flex items-center gap-2 px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[e.jsx(d,{})," Cancel"]})]}),e.jsxs("button",{onClick:()=>{h({type:"auth/logout"}),localStorage.removeItem("authToken"),a("Signed out",{icon:"ðŸ‘‹"})},title:"Sign out",className:"ml-2 inline-flex items-center gap-2 px-3 py-2 bg-red-50 text-red-700 rounded-md hover:bg-red-100",children:[e.jsx(o,{})," Sign out"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[200px_1fr] gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[U?e.jsx("img",{src:U,alt:`${$} avatar`,className:"w-36 h-36 rounded-full object-cover border-4 border-gray-100 shadow"}):e.jsx("div",{className:"w-36 h-36 rounded-full bg-gray-100 flex items-center justify-center text-xl font-semibold text-gray-500 border-4 border-gray-100",children:(null==(g=null==(u=N.firstName)?void 0:u.charAt(0))?void 0:g.toUpperCase())||"U"}),"edit"===b&&e.jsxs("label",{htmlFor:"avatar",className:"absolute -bottom-2 -right-2 bg-white p-2 rounded-full shadow cursor-pointer border",title:"Change avatar",children:[e.jsx(m,{className:"text-gray-600"}),e.jsx("input",{id:"avatar",ref:F,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;return(e=>{if(!e)return;if(!["image/png","image/jpeg","image/webp"].includes(e.type))return void a.error("Please select a PNG/JPEG/WebP image");P(e);const t=URL.createObjectURL(e);E(t)})(null==(t=e.target.files)?void 0:t[0])}})]})]}),e.jsxs("div",{className:"text-center md:text-left text-sm text-gray-500",children:[e.jsx("div",{className:"font-medium text-gray-800",children:$||"Unnamed User"}),e.jsx("div",{children:N.email}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Pro tip: use a clear headshot for better recognition."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{label:"Full name",children:"view"===b?e.jsx("div",{className:"text-lg font-medium text-gray-800",children:$}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",value:N.firstName,onChange:e=>f(a=>({...a,firstName:e.target.value})),className:"w-full px-3 py-2 border rounded "+(T.firstName?"border-red-400":"border-gray-300"),"aria-label":"First name"}),T.firstName&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:T.firstName})]}),e.jsxs("div",{children:[e.jsx("input",{type:"text",value:N.lastName,onChange:e=>f(a=>({...a,lastName:e.target.value})),className:"w-full px-3 py-2 border rounded "+(T.lastName?"border-red-400":"border-gray-300"),"aria-label":"Last name"}),T.lastName&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:T.lastName})]})]})}),e.jsx(c,{label:"Email address",children:e.jsx("div",{className:"text-sm text-gray-700",children:N.email})}),e.jsx(c,{label:"Phone number",children:"view"===b?e.jsx("div",{className:"text-sm text-gray-700",children:N.phoneNo||"Not provided"}):e.jsxs("div",{children:[e.jsx("input",{type:"tel",value:N.phoneNo||"",onChange:e=>f(a=>({...a,phoneNo:e.target.value})),className:"w-full px-3 py-2 border rounded "+(T.phoneNo?"border-red-400":"border-gray-300"),"aria-label":"Phone number",placeholder:"+1234567890"}),T.phoneNo&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:T.phoneNo})]})}),e.jsx(c,{label:"Role",children:e.jsx("span",{className:"inline-block px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-sm",children:N.role})}),e.jsxs("div",{className:"pt-2 border-t border-gray-100 mt-4 flex flex-col md:flex-row gap-3",children:[e.jsx("button",{onClick:()=>{a("Change password flow not implemented in this component",{icon:"ðŸ”’"})},className:"px-4 py-2 bg-gray-50 border border-gray-200 rounded text-gray-700 hover:bg-gray-100",children:"Change password"}),e.jsx("button",{onClick:()=>{l.post("/api/users/resend-verification",{},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")||v||""}`}}).then(e=>{var t;a.success((null==(t=e.data)?void 0:t.message)||"Verification email sent")}).catch(e=>{a.error("Unable to resend verification")})},className:"px-4 py-2 bg-white border border-gray-200 rounded text-gray-700 hover:bg-gray-50",children:"Resend verification email"})]})]})]})]})}):e.jsx("p",{className:"text-gray-500 text-center py-10",children:"No profile data available."})}export{u as default};
