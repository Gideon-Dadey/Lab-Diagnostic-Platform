import{j as e,V as a}from"./ui-vendor-D_YnDhxq.js";import{a as s}from"./react-vendor-B1YRfcvv.js";import{u as r,e as t}from"./redux-vendor-Cc4mDNFq.js";import{a as l}from"./utils-vendor-B4hhIH4d.js";import{e as i,aD as o,L as n,aG as d}from"./index-BpOdPcLd.js";function m(){return e.jsxs("div",{className:"bg-white shadow-md rounded-xl p-6 max-w-4xl mx-auto animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-6"}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})]})}function c(){var c,u;const p=r(),x=t(e=>{var a;return null==(a=e.auth)?void 0:a.user}),h=t(e=>{var a;return null==(a=e.auth)?void 0:a.token}),N=s.useMemo(()=>localStorage.getItem("authToken")||h||"",[h]),[g,f]=s.useState({firstName:"",lastName:"",phoneNo:""}),[v,b]=s.useState(null),[j,y]=s.useState(null),[w,U]=s.useState(""),[C,S]=s.useState(0),[P,k]=s.useState(!1),[L,A]=s.useState({}),E=s.useRef(null);s.useEffect(()=>{if(x){const e={firstName:x.firstName||"",lastName:x.lastName||"",phoneNo:x.phoneNo||""};f(e),b(e),U(x.image||"")}},[x]);const R=s.useMemo(()=>{if(!v)return!0;const e=v.firstName!==g.firstName||v.lastName!==g.lastName,a=(v.phoneNo||"")!==(g.phoneNo||""),s=!j&&!1!=(!!w&&w!==((null==x?void 0:x.image)||""))&&!!j;return e||a||s},[g,v,j,w,x]);s.useEffect(()=>()=>{w&&w.startsWith("blob:")&&URL.revokeObjectURL(w)},[w]);return x?e.jsxs("div",{className:"bg-white shadow-md rounded-xl p-6 max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6 border-b pb-2",children:"Edit Profile"}),e.jsx("form",{onSubmit:async e=>{var s,r,t,i,o;if(e&&e.preventDefault(),x&&x._id)if((()=>{const e={};return(!g.firstName||g.firstName.trim().length<2)&&(e.firstName="First name must be at least 2 characters"),(!g.lastName||g.lastName.trim().length<2)&&(e.lastName="Last name must be at least 2 characters"),g.phoneNo&&!/^\+?\d{7,15}$/.test(g.phoneNo.trim())&&(e.phoneNo="Enter a valid phone number (7â€“15 digits, optional leading +)"),A(e),0===Object.keys(e).length})()){k(!0),S(0);try{const e=`/api/auth/profile/${x._id}`,i=new FormData;i.append("firstName",g.firstName.trim()),i.append("lastName",g.lastName.trim()),i.append("phoneNo",(null==(s=g.phoneNo)?void 0:s.trim())||""),j&&i.append("image",j),!j&&""===w&&(null==x?void 0:x.image)&&i.append("removeImage","true");const o=(await l.put(e,i,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${N}`},onUploadProgress:e=>{if(!e.total)return;const a=Math.round(100*e.loaded/e.total);S(a)},timeout:3e4})).data;if(null==o?void 0:o.success){const e=o.user||{...x,firstName:g.firstName.trim(),lastName:g.lastName.trim(),phoneNo:(null==(r=g.phoneNo)?void 0:r.trim())||"",image:(null==(t=o.user)?void 0:t.image)??(j?w:(null==x?void 0:x.image)??"")};try{p(d(e))}catch(n){p({type:"auth/updateUser",payload:e})}b({firstName:e.firstName||"",lastName:e.lastName||"",phoneNo:e.phoneNo||""}),y(null),U(e.image||""),a.success("Profile updated successfully")}else a.error((null==o?void 0:o.message)||"Update failed")}catch(n){l.isAxiosError(n)?a.error((null==(o=null==(i=n.response)?void 0:i.data)?void 0:o.message)||"Network error while updating profile"):a.error("An unexpected error occurred")}finally{k(!1),S(0)}}else a.error("Please fix validation errors");else a.error("User not loaded")},className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden border-2 border-gray-100 bg-gray-50 flex items-center justify-center",children:w?e.jsx("img",{src:w,alt:"Avatar preview",className:"w-full h-full object-cover"}):x.image?e.jsx("img",{src:x.image,alt:"Current avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-gray-400 font-semibold text-xl",children:((null==(c=g.firstName)?void 0:c.charAt(0))||(null==(u=x.firstName)?void 0:u.charAt(0))||"U").toUpperCase()})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:"avatar",className:"inline-flex items-center gap-2 px-3 py-2 bg-white border rounded text-sm cursor-pointer hover:bg-gray-50",title:"Upload new avatar",children:[e.jsx(i,{}),e.jsx("span",{children:"Change"}),e.jsx("input",{id:"avatar",ref:E,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var s;return(e=>{if(!e)return;if(!["image/png","image/jpeg","image/webp"].includes(e.type))return void a.error("Please upload a PNG, JPEG or WebP image");if(e.size>2097152)return void a.error("Please use an image smaller than 2MB");y(e);const s=URL.createObjectURL(e);U(s)})(null==(s=e.target.files)?void 0:s[0])},disabled:P,"aria-label":"Upload avatar"})]}),e.jsx("button",{type:"button",onClick:()=>{y(null),U(""),f(e=>({...e}))},disabled:P&&!j,className:"inline-flex items-center gap-2 px-3 py-2 border rounded text-sm bg-white hover:bg-gray-50",children:"Remove"}),C>0&&e.jsx("div",{className:"w-40 bg-gray-100 rounded-full overflow-hidden h-2 mt-2",children:e.jsx("div",{style:{width:`${C}%`},className:"bg-primary h-full transition-all"})})]})]}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"First name"}),e.jsx("input",{type:"text",value:g.firstName,onChange:e=>f(a=>({...a,firstName:e.target.value})),className:"mt-1 w-full px-3 py-2 border rounded "+(L.firstName?"border-red-400":"border-gray-300"),disabled:P,"aria-invalid":!!L.firstName}),L.firstName&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:L.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Last name"}),e.jsx("input",{type:"text",value:g.lastName,onChange:e=>f(a=>({...a,lastName:e.target.value})),className:"mt-1 w-full px-3 py-2 border rounded "+(L.lastName?"border-red-400":"border-gray-300"),disabled:P,"aria-invalid":!!L.lastName}),L.lastName&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:L.lastName})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Phone"}),e.jsx("input",{type:"tel",value:g.phoneNo,onChange:e=>f(a=>({...a,phoneNo:e.target.value})),className:"mt-1 w-full px-3 py-2 border rounded "+(L.phoneNo?"border-red-400":"border-gray-300"),disabled:P,placeholder:"+1234567890","aria-invalid":!!L.phoneNo}),L.phoneNo&&e.jsx("div",{className:"text-xs text-red-500 mt-1",children:L.phoneNo})]}),e.jsxs("div",{className:"mt-6 flex items-center gap-3",children:[e.jsxs("button",{type:"submit",disabled:P||!R,className:"inline-flex items-center gap-2 px-4 py-2 rounded text-white "+(P||!R?"bg-gray-300 cursor-not-allowed":"bg-primary hover:bg-primary-dark"),"aria-disabled":P||!R,children:[P?e.jsx(o,{className:"animate-spin"}):e.jsx(o,{})," ",P?"Saving...":"Save changes"]}),e.jsxs("button",{type:"button",onClick:()=>{f({...v||{}}),y(null),U((null==x?void 0:x.image)||""),A({})},disabled:P,className:"inline-flex items-center gap-2 px-4 py-2 rounded border bg-white hover:bg-gray-50",children:[e.jsx(n,{})," Cancel"]})]})]})]})})]}):e.jsx(m,{})}export{c as default};
