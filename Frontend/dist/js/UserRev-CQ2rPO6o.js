import{j as e}from"./ui-vendor-D_YnDhxq.js";import{a as t}from"./react-vendor-B1YRfcvv.js";import{a9 as s,Z as a,aa as r,ab as l,s as i}from"./index-BpOdPcLd.js";import{a as n}from"./utils-vendor-B4hhIH4d.js";import"./redux-vendor-Cc4mDNFq.js";const c=t=>{const s=[];for(let a=1;a<=5;a++){const r=t>=a?"text-yellow-400":t>=a-.5?"text-yellow-300":"text-gray-300";s.push(e.jsx(i,{className:`inline-block mr-0.5 ${r}`,"aria-hidden":"true"},a))}return e.jsx("span",{className:"flex items-center","aria-hidden":!0,children:s})},o=({lab:t})=>e.jsx("article",{tabIndex:0,role:"group","aria-label":`${t.name} review card`,className:"min-w-[320px] max-w-[420px] h-64 flex-shrink-0 border border-gray-100 bg-white p-6 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 hover:shadow-lg transition-shadow duration-200",children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"w-1/3 flex items-center justify-center border-r border-gray-100 pr-4",children:e.jsx("img",{src:t.image||"/default-lab.jpg",alt:t.name,loading:"lazy",className:"max-h-28 max-w-full object-contain",onError:e=>e.target.src="/default-lab.jpg"})}),e.jsxs("div",{className:"w-2/3 pl-4 flex flex-col",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-black leading-tight",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mt-1",children:[e.jsx(r,{className:"text-indigo-600"}),e.jsx("span",{className:"truncate",children:t.location||t.address||"Location not specified"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[c(t.rating||0),e.jsx("span",{className:"ml-1 text-indigo-600 font-semibold",children:t.rating?t.rating.toFixed(1):"New"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",t.ratingCount||t.reviews&&t.reviews.length||0," reviews)"]})]})]}),e.jsx("div",{className:"flex-1 mt-3 overflow-hidden",children:t.reviews&&t.reviews.length>0?t.reviews.slice(0,2).map(t=>{var s,a,r;return e.jsxs("div",{className:"mb-3 p-3 border border-gray-50 bg-gray-50 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[(null==(s=t.user)?void 0:s.image)?e.jsx("img",{src:t.user.image,alt:`${t.user.firstName} avatar`,className:"w-8 h-8 rounded-full object-cover"}):e.jsx(l,{className:"w-8 h-8 text-indigo-200"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[null==(a=t.user)?void 0:a.firstName," ",null==(r=t.user)?void 0:r.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleDateString()})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-xs text-gray-500",children:[c(t.rating),e.jsxs("span",{children:[t.rating,"/5"]})]})]}),e.jsxs("p",{className:"text-gray-700 italic",children:["“",t.comment,"”"]})]},t._id)}):e.jsx("div",{className:"text-sm text-gray-400 italic py-6",children:"No reviews yet for this lab."})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsx("a",{href:`/labs/${t._id}/details`,className:"text-indigo-600 font-medium text-sm hover:underline",children:"View Lab Details"}),e.jsx("a",{href:`/labs/${t._id}/details#reviews`,className:"text-black font-semibold text-sm hover:underline",children:"View All Reviews"})]})]})]})}),d=()=>{const[r,l]=t.useState([]),[i,c]=t.useState(!0),[d,m]=t.useState(!0),x=t.useRef(null),h=t.useRef(null);t.useEffect(()=>{let e=!0;return(async()=>{c(!0);try{const{data:t}=await n.get("/api/labs/public"),s=t.labs||[],a=s.map(e=>n.get(`/api/labs/${e._id}/reviews`).then(e=>e.data.reviews||[]).catch(()=>[])),r=await Promise.all(a),i=s.map((e,t)=>({...e,reviews:r[t]||[],rating:e.rating??(r[t]?r[t].reduce((e,t)=>e+(t.rating||0),0)/Math.max(1,r[t].length):0),ratingCount:e.ratingCount??(r[t]?r[t].length:0)}));e&&l(i)}catch(t){e&&l([])}finally{e&&c(!1)}})(),()=>{e=!1}},[]),t.useEffect(()=>{const e=x.current;if(!e)return;if(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;return h.current=setInterval(()=>{if(!d)return;if(!e)return;const t=e.scrollWidth-e.clientWidth;e.scrollLeft>=t-2?e.scrollTo({left:0,behavior:"smooth"}):e.scrollBy({left:1,behavior:"smooth"})},30),()=>clearInterval(h.current)},[d,r.length]);const f=t.useCallback(e=>{const t=x.current;if(!t)return;const{scrollLeft:s,clientWidth:a}=t,r=Math.round(.8*a);t.scrollTo({left:"left"===e?Math.max(0,s-r):s+r,behavior:"smooth"})},[]);return t.useEffect(()=>{const e=x.current;if(!e)return;const t=()=>m(!1),s=()=>m(!0);return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",s),()=>{e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",s)}},[]),i?e.jsx("section",{className:"w-full bg-white text-black min-h-[60vh] flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 border-t-4 border-indigo-600 rounded-full animate-spin"}),e.jsx("div",{className:"text-black",children:"Loading lab reviews…"})]})}):e.jsx("section",{className:"w-full bg-white text-black py-12",children:e.jsxs("div",{className:"w-full max-w-screen-2xl mx-auto px-6 lg:px-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-extrabold text-black",children:"Lab Reviews & Ratings"}),e.jsx("p",{className:"mt-2 text-gray-600 max-w-2xl",children:"Real feedback from users for every lab on our platform."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("a",{href:"/our-partners",className:"inline-flex items-center gap-2 px-5 py-2 bg-gradient-to-r from-indigo-600 to-sky-500 text-white font-semibold",children:"View All Lab Reviews"}),e.jsx("button",{onClick:()=>m(e=>!e),className:"px-3 py-2 border border-gray-200 text-gray-700","aria-pressed":!d,children:d?"Pause":"Resume"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>f("left"),"aria-label":"Scroll left",className:"hidden md:flex absolute left-0 top-1/2 -translate-y-1/2 z-20 items-center justify-center h-12 w-12 border border-gray-200 bg-white text-black",children:e.jsx(s,{})}),e.jsx("div",{ref:x,className:"flex gap-6 overflow-x-auto no-scrollbar py-2",style:{scrollBehavior:"smooth"},tabIndex:0,"aria-label":"Labs carousel, swipe to scroll",children:0===r.length?e.jsx("div",{className:"text-gray-500 p-4",children:"No labs available"}):r.map(t=>e.jsx(o,{lab:t},t._id))}),e.jsx("button",{onClick:()=>f("right"),"aria-label":"Scroll right",className:"hidden md:flex absolute right-0 top-1/2 -translate-y-1/2 z-20 items-center justify-center h-12 w-12 border border-gray-200 bg-white text-black",children:e.jsx(a,{})})]})]})})};export{d as default};
