import{j as e,c as t}from"./ui-vendor-D_YnDhxq.js";import{u as a,a as s,L as r,f as i}from"./react-vendor-B1YRfcvv.js";import{u as l,e as n}from"./redux-vendor-Cc4mDNFq.js";import{a as d}from"./utils-vendor-B4hhIH4d.js";import{A as o}from"./index-DjckN64C.js";import{am as c,an as m,ao as x,ap as h,aa as p,ac as u,R as g,aq as b,a as y}from"./index-BpOdPcLd.js";import{c as j,d as f,e as N}from"./index-D8HxDPmi.js";const v=()=>{const i=l(),d=a(),[o,h]=s.useState(!0),[p,u]=s.useState(!1),[g,b]=s.useState(!1),y=n(e=>{var t;return null==(t=e.lab)?void 0:t.currentLabId}),v=n(e=>e.cart.items),w=v.filter(e=>e.labId===y),k=w.reduce((e,t)=>e+Number(t.price)*t.quantity,0),C=async(e,a)=>{const s=v.find(t=>t._id===e);if(!s)return;const r="inc"===a?s.quantity+1:Math.max(1,s.quantity-1);try{const a={quantity:r},s=await fetch(`/api/cart/quantity/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(a)});if(!s.ok){const e=await s.text();throw new Error(`Server returned ${s.status}: ${e}`)}const l=await s.json();l.success?i(x({_id:e,quantity:r})):t.error(l.message||"Failed to update quantity")}catch(l){t.error("Failed to update quantity")}};return s.useEffect(()=>{(async()=>{h(!0);try{const e=await fetch("/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),a=await e.json();a.success&&Array.isArray(a.cartItems)?i(c(a.cartItems)):t.error(a.message||"Failed to load cart")}catch(e){t.error("Failed to fetch cart")}finally{h(!1)}})()},[]),o?e.jsx("p",{className:"text-gray-600 mt-6",children:"Loading cart..."}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Shopping Cart"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[w.length," ",1===w.length?"item":"items"]})]}),0===w.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),e.jsx("p",{className:"text-gray-600 font-medium mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Add tests and packages to get started"}),e.jsx(r,{to:"/labs",className:"inline-flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary/90 transition",children:"Browse Labs"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 mb-6",children:w.map(a=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl border border-gray-200 hover:border-primary/30 transition-colors bg-gray-50/50",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["$",Number(a.price).toFixed(2)," Ã— ",a.quantity]})]}),e.jsx("div",{className:"text-right mr-4",children:e.jsxs("p",{className:"font-bold text-lg text-gray-900",children:["$",(Number(a.price)*a.quantity).toFixed(2)]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(a._id,"dec"),disabled:g||a.quantity<=1,className:"p-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition","aria-label":"Decrease quantity",children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center font-semibold text-gray-900",children:a.quantity}),e.jsx("button",{onClick:()=>C(a._id,"inc"),disabled:g,className:"p-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition","aria-label":"Increase quantity",children:e.jsx(f,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>(async e=>{if(!g){b(!0);try{const a=await fetch(`/api/cart/remove/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),s=await a.json();s.success?(i(m(e)),t.success("Item removed from cart")):t.error(s.message||"Failed to remove item")}catch(a){t.error("Error removing item")}finally{b(!1)}}})(a._id),disabled:g,className:"p-2 rounded-lg text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition","aria-label":"Remove item",children:e.jsx(N,{className:"w-5 h-5"})})]},a._id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-lg",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Total"}),e.jsxs("span",{className:"font-bold text-2xl text-primary",children:["$",k.toFixed(2)]})]}),e.jsx("button",{onClick:()=>{u(!0),d("/place-order")},disabled:p||g,className:"w-full py-3.5 rounded-xl text-white font-semibold transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none "+(p||g?"bg-gray-400":"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg hover:shadow-xl"),children:p?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Proceed to Checkout"})]})]})]})},w=()=>{var a;const{id:r}=i(),c=l();n(e=>e.cart.items);const[m,x]=s.useState([]),[j,f]=s.useState([]),[N,w]=s.useState(null),[k,C]=s.useState("All"),[S,q]=s.useState(""),[F,I]=s.useState(""),[L,$]=s.useState(null),[A,T]=s.useState(null);s.useState(""),s.useState(0);function _(t){return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:t||0})]})}s.useEffect(()=>{(async()=>{try{const{data:e}=await d.get(`/api/labs/public/${r}`);w(e.lab)}catch(e){}})()},[r]),s.useEffect(()=>{(async()=>{try{const[e,t]=await Promise.all([d.get("/api/tests/get-all-tests"),d.get("/api/tests/get-all-packages")]);x(e.data.tests.filter(e=>{var t;return(null==(t=e.lab)?void 0:t.toString())===r||e.lab===r})),f(t.data.packages.filter(e=>{var t;return(null==(t=e.lab)?void 0:t.toString())===r||e.lab===r}))}catch(e){}})()},[r]),s.useEffect(()=>{r&&c(h(r))},[r,c]);let P=[...m.map(e=>({...e,type:"Test"})),...j.map(e=>({...e,type:"Package"}))];return P=P.filter(e=>e.name.toLowerCase().includes(F.toLowerCase())&&("All"===k||e.type===k)),P.sort((e,t)=>"low"===S?e.price-t.price:"high"===S?t.price-e.price:"booked"===S?(t.bookedCount||0)-(e.bookedCount||0):"rating"===S?(t.rating||0)-(e.rating||0):"lowrating"===S?(e.rating||0)-(t.rating||0):0),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"mb-6 inline-flex items-center text-primary hover:underline",children:[e.jsx(o,{className:"rotate-180 mr-2"}),"Back to Labs"]}),N&&e.jsxs("div",{className:"flex flex-col md:flex-row bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 mb-12 items-center md:items-start gap-12",children:[e.jsx("div",{className:"w-full md:w-1/3 flex justify-center relative",children:e.jsxs("div",{className:"w-72 h-72 rounded-2xl overflow-hidden border-4 border-primary shadow-lg relative",children:[e.jsx("img",{src:N.image,alt:N.name,className:"w-full h-full object-cover object-center"}),e.jsxs("div",{className:"absolute top-4 right-4 flex items-center gap-1 z-10",children:[e.jsx("span",{className:"font-semibold text-yellow-600 text-lg drop-shadow-md",children:(null==(a=N.rating)?void 0:a.toFixed(1))||"New"}),_(N.bookedCount)]})]})}),e.jsxs("div",{className:"flex-1 relative flex flex-col justify-center",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-2",children:e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-text-dark",children:N.name})}),N.description&&e.jsx("p",{className:"mt-6 text-text-primary text-lg leading-relaxed mb-6",children:N.description}),e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary mb-2",children:[e.jsx(p,{className:"text-primary"}),e.jsx("span",{className:"text-md",children:N.address||N.location})]}),e.jsxs("div",{className:"flex flex-wrap gap-6 mt-2 text-gray-700 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"text-primary"}),e.jsx("span",{children:N.phone||N.contactNumber||"Not available"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"text-primary"}),e.jsx("span",{children:N.email||"Not available"})]})]})]})]}),e.jsx("h1",{className:"text-3xl font-bold text-primary mb-4",children:"Tests & Packages"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search by name...",value:F,onChange:e=>I(e.target.value),className:"flex-grow min-w-[160px] px-4 py-2 border rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsxs("select",{value:S,onChange:e=>{return t=e.target.value,q(t);var t},className:"w-auto px-4 py-2 border rounded shadow-sm",children:[e.jsx("option",{value:"",children:"Sort by"}),e.jsx("option",{value:"low",children:"Price: Low to High"}),e.jsx("option",{value:"high",children:"Price: High to Low"}),e.jsx("option",{value:"booked",children:"Most Booked"}),e.jsx("option",{value:"rating",children:"Rating: High to Low"}),e.jsx("option",{value:"lowrating",children:"Rating: Low to High"})]})]}),e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex gap-4",children:["All","Test","Package"].map(t=>e.jsx("button",{onClick:()=>(e=>C(e))(t),className:"px-4 py-2 border rounded-lg shadow transition "+(k===t?"bg-primary text-white":"text-primary border-primary"),children:t},t))})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.map(a=>e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:"inline-block px-2 py-1 text-xs font-semibold bg-blue-100 text-primary/90 rounded-full",children:a.type}),e.jsx("div",{className:"text-sm text-gray-500",children:_(a.bookedCount)})]}),e.jsx("h2",{className:"font-bold text-lg text-gray-800 mb-4",children:a.name}),e.jsx("div",{className:"flex items-center gap-2 mb-4",children:a.discount>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xl font-bold text-primary",children:["PKR ",Math.round(a.price*(1-(a.discount||0)/100))]}),e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["PKR ",a.price]}),e.jsxs("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full",children:[a.discount,"% OFF"]})]}):e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$ ",a.price]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>(e=>$(e))(a),className:"px-3 py-2 border border-primary text-primary rounded-lg hover:bg-primary hover:text-white transition-colors",children:"View Details"}),e.jsx("button",{onClick:()=>(async e=>{var a,s;try{T(e._id);const a=await d.post("/api/cart/add",{testOrPackageId:e._id,type:e.type,name:e.name,price:e.price,labId:r},{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(a.data.success){const s={_id:a.data.itemId||e._id,name:e.name,price:e.price,type:e.type,labId:r,quantity:1};c(b(s)),t.success("Item added to cart")}else t.error(a.data.message||"Failed to add to cart")}catch(i){t.error((null==(s=null==(a=i.response)?void 0:a.data)?void 0:s.message)||"Failed to add to cart")}finally{T(null)}})(a),disabled:A===a._id,className:"px-3 py-2 rounded-lg transition-colors "+(A===a._id?"bg-gray-300 text-gray-500":"bg-primary text-white hover:bg-primary-dark"),children:A===a._id?"Adding...":"Add to Cart"})]})]})},a._id))}),e.jsx(v,{}),L&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg max-w-md w-full relative shadow-lg space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:L.name})}),e.jsx("div",{className:"text-gray-700 mb-2",children:L.description}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"text-lg font-bold text-primary",children:["$ ",L.price]}),L.discount>0&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:[" $ ",L.price/(1-(L.discount||0)/100)]}),L.discount>0&&e.jsxs("span",{className:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full",children:[L.discount,"% OFF"]})]}),"Package"===L.type&&(L.includedTests||L.tests)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Included Tests:"}),e.jsx("ul",{className:"list-inside text-gray-700",children:(L.includedTests||L.tests).map((t,a)=>{const s=["list-disc","list-circle","list-square"],r=s[a%s.length];return e.jsx("li",{className:r+" ml-5",children:t.name||t},a)})})]}),e.jsx("button",{onClick:()=>$(null),className:"text-red-500 hover:underline mt-4",children:"Close"})]})})]})};export{w as default};
