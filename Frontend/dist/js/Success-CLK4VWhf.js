import{j as e,c as t}from"./ui-vendor-D_YnDhxq.js";import{u as a,a as r}from"./react-vendor-B1YRfcvv.js";const o=()=>{const o=a();return r.useEffect(()=>{(async()=>{const e=JSON.parse(localStorage.getItem("bookingData"))||{};try{const a=await fetch("/api/cart",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),r=await a.json();if(!r.success||!r.cartItems)throw new Error("Cart is empty or unavailable.");const s=r.cartItems.map(e=>{if(!e.testOrPackageId&&!e._id)throw new Error("Cart item missing testOrPackageId");if(!e.type)throw new Error(`Cart item '${e.name}' is missing 'type' field`);return{testOrPackageId:e.testOrPackageId||e._id,name:e.name||"Unnamed Item",price:e.price||0,type:e.type,labId:e.labId||null}}),c=s[0],i={...e,testOrPackageId:c.testOrPackageId,type:c.type,name:c.name,items:s},n=await fetch("/api/orders/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify(i)});if(!n.ok){const e=await n.text();throw new Error("Order creation failed: "+e)}await fetch("/api/cart/clear",{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),t.success("Order placed and cart cleared!"),localStorage.removeItem("bookingData"),o("/user/orders")}catch(a){t.error("Order placement failed: "+a.message)}})()},[o]),e.jsxs("div",{className:"text-center mt-20",children:[e.jsx("h1",{className:"text-2xl font-bold text-green-600",children:"Payment Successful âœ…"}),e.jsx("p",{children:"Processing your order, please wait..."})]})};export{o as default};
