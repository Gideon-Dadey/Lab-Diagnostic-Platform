import{j as e,c as s}from"./ui-vendor-D_YnDhxq.js";import{u as t,a,c as r}from"./react-vendor-B1YRfcvv.js";import{e as l}from"./redux-vendor-Cc4mDNFq.js";const d=()=>{const d=t(),[i,n]=a.useState([]),[o,c]=a.useState(!0),m=r(),{user:h}=l(e=>e.auth),x=async()=>{try{const e=await fetch("/api/orders/lab",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),s=await e.json();if(s.orders){const e=s.orders.map(e=>{const s=e.items.filter(e=>e.labId&&(e.labId._id||e.labId).toString()===h.labId);return s.length>0?{...e,items:s,labStatus:s[0].status||"Pending",patientName:e.userId?`${e.userId.firstName} ${e.userId.lastName}`:e.name||"Unknown"}:null}).filter(Boolean);n(e)}else n([])}catch(e){s.error("Failed to fetch orders")}finally{c(!1)}};return a.useEffect(()=>{x()},[m.search]),o?e.jsx("p",{className:"text-gray-500",children:"Loading orders..."}):e.jsxs("div",{className:"p-4 w-full",children:[e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6 mt-4 w-full",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Orders Overview"}),e.jsx("p",{className:"text-gray-700",children:"Quick view of bookings received"})]}),e.jsx("div",{className:"bg-white p-2 shadow-lg rounded-lg mt-4 overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse min-w-[900px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-primary text-white text-left",children:[e.jsx("th",{className:"p-3",children:"Patient Name"}),e.jsx("th",{className:"p-3",children:"Tests/Packages"}),e.jsx("th",{className:"p-3",children:"Booking Date"}),e.jsx("th",{className:"p-3",children:"Collection"}),e.jsx("th",{className:"p-3",children:"Lab Status"}),e.jsx("th",{className:"p-3",children:"Payment"}),e.jsx("th",{className:"p-3",children:"Report"}),e.jsx("th",{className:"p-3",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(t=>{var a,r,l;return e.jsxs("tr",{className:"border-b hover:bg-gray-100 transition",children:[e.jsx("td",{className:"p-3",children:t.patientName}),e.jsx("td",{className:"p-3",children:e.jsx("ul",{className:"list-disc list-inside",children:t.items.map((s,t)=>e.jsxs("li",{className:"text-sm",children:[s.name," (",s.type,")"]},t))})}),e.jsxs("td",{className:"p-3",children:[new Date(null==(a=t.bookingDetails)?void 0:a.date).toLocaleDateString()," ",null==(r=t.bookingDetails)?void 0:r.time]}),e.jsx("td",{className:"p-3",children:t.collectionMethod}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-sm "+("Completed"===t.labStatus?"bg-green-100 text-green-800":"Cancelled"===t.labStatus?"bg-red-100 text-red-700":"In Progress"===t.labStatus?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"),children:t.labStatus})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:"px-2 py-1 rounded text-sm "+("paid"===t.paymentStatus?"bg-green-100 text-green-800":"bg-red-100 text-red-700"),children:t.paymentStatus||"pending"})}),e.jsx("td",{className:"p-3",children:t.items.some(e=>e.reportFile)?e.jsx("a",{href:null==(l=t.items.find(e=>e.reportFile))?void 0:l.reportFile,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline text-sm",children:"View Report"}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Not Uploaded"})}),e.jsxs("td",{className:"p-3 flex gap-2",children:[e.jsx("button",{onClick:()=>d(`/labadmin/lab/orders/edit/${t._id}`),className:"bg-primary text-white px-3 py-1 rounded",children:"View / Edit"}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this order? This action cannot be undone."))try{const t=await fetch(`/api/orders/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Failed to delete order")}s.success("Order deleted successfully"),x()}catch(t){s.error(t.message||"Error deleting order")}})(t._id),className:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700",children:"Delete"})]})]},t._id)})})]})})]})};export{d as default};
