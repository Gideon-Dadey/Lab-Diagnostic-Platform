import{j as e}from"./ui-vendor-D_YnDhxq.js";import{a as s}from"./react-vendor-B1YRfcvv.js";import{a,c as t,b as l}from"./index-BpOdPcLd.js";import"./redux-vendor-Cc4mDNFq.js";import"./utils-vendor-B4hhIH4d.js";const r=()=>{const[r,i]=s.useState([]),[n,d]=s.useState([]),[c,o]=s.useState(0),[m,x]=s.useState(!1),[p,u]=s.useState(!1),[h,y]=s.useState(null),[j,b]=s.useState(""),[g,w]=s.useState({name:"",email:"",subject:"",description:""}),N={Authorization:`Bearer ${localStorage.getItem("authToken")}`},f=async(e,s={})=>{try{const a=await fetch(e,{headers:{...N,...s.headers||{}},...s});return await a.json()}catch(a){return null}},v=async()=>{x(!0);const e=await f("/api/query/inbox");(null==e?void 0:e.success)&&Array.isArray(e.inboxMessages)?(i(e.inboxMessages),o(e.inboxMessages.filter(e=>"unviewed"===e.status).length)):(i([]),o(0)),x(!1)},S=async()=>{const e=await f("/api/query/superadmin-responses");(null==e?void 0:e.success)&&Array.isArray(e.messages)?d(e.messages):d([])};s.useEffect(()=>{v(),S();const e=setInterval(()=>{v(),S()},1e4);return()=>clearInterval(e)},[]);const C=e.jsxs("div",{className:"bg-white p-6 shadow-lg rounded-lg mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Contact Super Admin"}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s=await fetch("/api/query/submit",{method:"POST",headers:{"Content-Type":"application/json",...N},body:JSON.stringify({...g,message:g.description,receiverType:"support",labId:""})}),a=await s.json();s.ok?(alert("Message sent to Super Admin!"),w({name:"",email:"",subject:"",description:""}),u(!1)):alert(a.message||"Failed to send message.")},className:"space-y-4",children:[["name","email","subject"].map(s=>e.jsx("input",{type:"email"===s?"email":"text",name:s,placeholder:s.charAt(0).toUpperCase()+s.slice(1),value:g[s],onChange:e=>w(a=>({...a,[s]:e.target.value})),required:!0,className:"w-full p-3 border border-gray-300 rounded-lg"},s)),e.jsx("textarea",{name:"description",placeholder:"Message",value:g.description,onChange:e=>w(s=>({...s,description:e.target.value})),required:!0,rows:"5",className:"w-full p-3 border border-gray-300 rounded-lg"}),e.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded-lg w-full",children:"Send Message"})]})]}),A=e.jsxs("div",{className:"bg-white p-6 shadow-lg rounded-lg mt-4",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Reply to: ",(null==h?void 0:h.subject)||"No Subject"]}),e.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg",rows:"5",placeholder:"Type your reply...",value:j,onChange:e=>b(e.target.value)}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{onClick:()=>(async(e,s)=>{const a=await fetch(`/api/inbox/reply/${e}`,{method:"POST",headers:{"Content-Type":"application/json",...N},body:JSON.stringify({response:s})});if(a.ok)i(a=>a.map(a=>a._id===e?{...a,response:s,status:"responded"}:a)),y(null),b("");else{const e=await a.json();alert(e.message||"Failed to send reply.")}})(h._id,j),className:"bg-blue-600 text-white px-4 py-2 rounded-lg",children:"Send Reply"}),e.jsx("button",{onClick:()=>y(null),className:"bg-gray-400 text-white px-4 py-2 rounded-lg",children:"Cancel"})]})]});return e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md mt-4 w-full max-w-8xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 bg-gray-100 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Need Assistance?"}),e.jsx("p",{className:"text-gray-600",children:"Contact the Super Admin for any queries or issues you face."})]}),e.jsx("button",{onClick:()=>{u(!0),y(null)},className:"bg-primary text-white px-4 py-2 rounded-lg",children:"Contact Super Admin"})]}),p?C:h?A:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("div",{children:["Inbox",c>0&&e.jsxs("span",{className:"ml-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:[c," Unread"]})]})}),e.jsx("div",{className:"overflow-auto max-w-full",children:m?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsxs("svg",{className:"animate-spin h-10 w-10 text-primary",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]})}):e.jsx("div",{className:"min-w-[800px]",children:e.jsxs("table",{className:"w-full text-left border border-gray-300 rounded-md overflow-hidden",children:[e.jsx("thead",{className:"bg-primary text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2",children:"Name"}),e.jsx("th",{className:"px-3 py-2",children:"Email"}),e.jsx("th",{className:"px-3 py-2",children:"Subject"}),e.jsx("th",{className:"px-3 py-2",children:"Message"}),e.jsx("th",{className:"px-3 py-2",children:"Status"}),e.jsx("th",{className:"px-3 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:0===r.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center p-6 text-gray-500",children:"No Messages Found"})}):r.map(s=>e.jsxs("tr",{className:"border-b "+("unviewed"===s.status?"font-semibold":""),children:[e.jsx("td",{className:"px-3 py-2",children:s.name}),e.jsx("td",{className:"px-3 py-2",children:s.email}),e.jsx("td",{className:"px-3 py-2",children:s.subject}),e.jsx("td",{className:"px-3 py-2",children:s.message}),e.jsx("td",{className:"px-3 py-2 capitalize",children:s.status}),e.jsxs("td",{className:"px-3 py-2 flex gap-2",children:[e.jsx("button",{title:"Mark as Viewed",onClick:()=>(async e=>{await f(`/api/inbox/view/${e}`,{method:"PATCH"}),i(s=>s.map(s=>s._id===e?{...s,status:"viewed"}:s)),o(e=>Math.max(e-1,0))})(s._id),disabled:"unviewed"!==s.status,className:"text-primary hover:text-primary-dark disabled:opacity-50",children:e.jsx(a,{})}),e.jsx("button",{title:"Reply",onClick:()=>{y(s),b(s.response||""),u(!1)},className:"text-blue-600 hover:text-blue-800",children:e.jsx(t,{})}),e.jsx("button",{title:"Delete Message",onClick:()=>{window.confirm("Are you sure you want to delete this message?")&&(async e=>{await f(`/api/inbox/delete/${e}`,{method:"DELETE"}),i(s=>s.filter(s=>s._id!==e))})(s._id)},className:"text-red-600 hover:text-red-800",children:e.jsx(l,{})})]})]},s._id))})]})})})]})]})};export{r as default};
