import{j as e,V as s}from"./ui-vendor-D_YnDhxq.js";import{a,u as t}from"./react-vendor-B1YRfcvv.js";import{c as r,a as l,u as i}from"./forms-vendor-CyXfoBQa.js";import{o as d}from"./yup-ANMf5mc7.js";import{F as n,a as c}from"./index-BpOdPcLd.js";import"./redux-vendor-Cc4mDNFq.js";import"./utils-vendor-B4hhIH4d.js";const o=r().shape({firstName:l().required("First name is required"),lastName:l().required("Last name is required"),email:l().email("Invalid email").required("Email is required"),password:l().min(6,"Password must be at least 6 characters").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])/,"Password must include uppercase, lowercase, number, and special character").when("isEdit",{is:!1,then:e=>e.required("Password is required"),otherwise:e=>e.notRequired()}),role:l().required("Role is required")}),m=({onSubmit:s,onCancel:t,user:r})=>{const[l,m]=a.useState(null),[x,u]=a.useState(""),[p,h]=a.useState(!1),{register:j,handleSubmit:b,setValue:f,setError:g,formState:{errors:y}}=i({resolver:d(o),defaultValues:{firstName:"",lastName:"",email:"",password:"",role:"",isEdit:!!r}});a.useEffect(()=>{r&&(f("firstName",r.firstName||""),f("lastName",r.lastName||""),f("email",r.email||""),f("password",""),f("role",r.role||""),u(r.image||""))},[r,f]);return e.jsxs("div",{className:"relative bg-white p-6 shadow-md rounded-md mt-6 w-full max-w-lg mx-auto",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-gray-800",children:r?"Edit User":"Add User"}),e.jsxs("form",{onSubmit:b(e=>{const a=new FormData;for(const s in e)"isEdit"!==s&&a.append(s,e[s]);l&&a.append("profileImage",l),r&&a.append("_id",r.id),s(a)}),className:"space-y-4",encType:"multipart/form-data",children:[e.jsx("div",{className:"flex flex-col items-center mb-4",children:e.jsx("img",{src:x||"https://via.placeholder.com/150",alt:"Profile Preview",className:"w-24 h-24 rounded-full object-cover border-2 border-primary"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Profile Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const s=e.target.files[0];s&&(m(s),u(URL.createObjectURL(s)))},className:"w-full mt-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{type:"text",...j("firstName"),className:"w-full px-3 py-2 border rounded-md"}),y.firstName&&e.jsx("p",{className:"text-red-500 text-sm",children:y.firstName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{type:"text",...j("lastName"),className:"w-full px-3 py-2 border rounded-md"}),y.lastName&&e.jsx("p",{className:"text-red-500 text-sm",children:y.lastName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",...j("email"),className:"w-full px-3 py-2 border rounded-md"}),y.email&&e.jsx("p",{className:"text-red-500 text-sm",children:y.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",...j("password"),className:"w-full px-3 py-2 border rounded-md pr-10"}),e.jsx("button",{type:"button",onClick:()=>h(!p),className:"absolute right-3 top-2.5 text-gray-500",children:p?e.jsx(n,{}):e.jsx(c,{})})]}),y.password&&e.jsx("p",{className:"text-red-500 text-sm",children:y.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{...j("role"),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Select Role"}),e.jsx("option",{value:"labadmin",children:"Lab Admin"}),e.jsx("option",{value:"user",children:"User"})]}),y.role&&e.jsx("p",{className:"text-red-500 text-sm",children:y.role.message})]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{type:"button",onClick:t,className:"bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-primary text-white px-4 py-2 rounded-md hover:bg-opacity-90",children:r?"Save Changes":"Add User"})]})]})]})},x=()=>{const[r,l]=a.useState([]),[i,d]=a.useState([]),[n,c]=a.useState(!1),[o,x]=a.useState(null),[u,p]=a.useState(""),h=t();a.useEffect(()=>{const e=localStorage.getItem("authToken");if(e){const s=JSON.parse(atob(e.split(".")[1]));p(s.id)}},[]);const j=async()=>{try{const e=await fetch("/api/labs/all",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),s=(await e.json()).labs||[];d(s);const a=await fetch("/api/superadmin/users",{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}}),t=await a.json(),r=(t.users||[]).map(e=>{var a,t;let r="Only User";return"labadmin"===e.role?r=(null==(a=s.find(s=>{var a;return(null==(a=s.labAdmin)?void 0:a._id)===e._id}))?void 0:a.name)||"Unassigned":"superadmin"===e.role&&(r="Platform Owner"),{id:e._id,name:`${e.firstName} ${e.lastName}`,email:e.email,role:e.role,ownedLab:r,createdAt:(null==(t=e.createdAt)?void 0:t.split("T")[0])||"-"}});l(r)}catch(e){}};a.useEffect(()=>{j()},[]);const b=(e,s=18)=>e.length>s?e.substring(0,s)+"...":e;return e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-lg mt-6 max-w-7xl mx-auto",children:n?e.jsx(m,{onSubmit:o?async e=>{try{const a=e.get("_id"),t=await fetch(`/api/superadmin/update-user/${a}`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:e}),r=await t.json();t.ok?(s.success("User updated successfully!"),j(),c(!1),x(null),h("/admin/super/users")):(s.error("Something went wrong"),alert(r.message||"Failed to update user."))}catch(a){alert("Update failed")}}:async e=>{try{const a=await fetch("/api/superadmin/create-user",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:e}),t=await a.json();a.ok?(s.success("User created successfully!"),j(),c(!1)):alert(t.message||"Failed to create user.")}catch(a){alert("Unexpected error while creating user.")}},onCancel:()=>{c(!1),x(null)},user:o,labs:i}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Users"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage all platform users"})]}),e.jsx("button",{onClick:()=>c(!0),className:"bg-primary hover:bg-primary-dark text-white font-semibold px-6 py-2 rounded-lg",children:"Add New User"})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse",children:[e.jsx("thead",{className:"bg-primary text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Owned Lab"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Created At"}),e.jsx("th",{className:"px-6 py-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white text-gray-700",children:r.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-100",children:[e.jsx("td",{className:"px-6 py-4",children:b(a.id)}),e.jsx("td",{className:"px-6 py-4",children:b(a.name)}),e.jsx("td",{className:"px-6 py-4 capitalize",children:a.role}),e.jsx("td",{className:"px-6 py-4",children:b(a.email)}),e.jsx("td",{className:"px-6 py-4",children:b(a.ownedLab)}),e.jsx("td",{className:"px-6 py-4",children:a.createdAt}),e.jsx("td",{className:"px-6 py-4 flex gap-2",children:"superadmin"===a.role?e.jsx("span",{className:"text-xs italic text-gray-400",children:"Platform Owner"}):a.id===u?e.jsx("span",{className:"text-xs italic text-gray-400",children:"Protected"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>(e=>{x(e),c(!0)})(a),className:"bg-primary text-white px-3 py-1 rounded-md hover:bg-primary-dark",children:"Edit"}),e.jsx("button",{onClick:()=>(async e=>{try{const a=await fetch(`/api/superadmin/delete-user/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("authToken")}`}});if(a.ok)s.success("User deleted successfully"),j();else{const e=await a.json();alert(e.message)}}catch(a){alert("Failed to delete user")}})(a.id),className:"bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600",children:"Delete"})]})})]},a.id))})]})})]})})};export{x as default};
